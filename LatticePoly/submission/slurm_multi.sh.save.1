65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M65;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M64;143;26M0;104;42M0;104;42m#!/bin/bash

##
##  slurm.sh
##  LatticePoly
##
##  Created by ddasaro on the model of mtortora on 20/06/2022
##  Copyright Â© 2022 ENS Lyon. All rights reserved.
##


#SBATCH -o %A_%a.out
#SBATCH -e %A_%a.err

# Relative path to code root directory
ROOTDIR=${SCRIPTDIR}/../..
echo "The present scriptdir directory is ${SCRIPTDIR}";



# Set working directory to root
cd ${ROOTDIR}

# Executable path
EXEC=bin/lat

# Data directory on local disk
DATDIR=data/output

# Name of output directory (based on job name & task ID)
ID=$(echo ${SLURM_ARRAY_TASK_ID} | awk '{printf("%04d\n", $1-1)}')

OUTDIR=${SLURM_JOB_NAME}${ID}

# Temporary directory on scratch
[ ! -d "${SCRATCHDIR}/${LOGNAME}/LatticeData/${SLURM_JOB_NAME}/" ] && mkdir -p ${SCRATCHDIR}/${LOGNAME}/LatticeData/${SLURM_JOB_NAME}/
mkdir ${SCRATCHDIR}/${LOGNAME}/LatticeData/${SLURM_JOB_NAME}/${OUTDIR}
TMPDIR=${SCRATCHDIR}/${LOGNAME}/LatticeData/${SLURM_JOB_NAME}/${OUTDIR}

# Create output directory if necessary
#[ ! -d "${TMPDIR}" ] && mkdir -p ${TMPDIR}

# Substitution strings
DIRSUB="s|\(outputDir[[:space:]]*=[[:space:]]*\)\(.*;\)|\1${TMPDIR} ;|;"

# Copy input configuration file to output directory, substituting paths and parameter values
sed -e "${DIRSUB}" < /home/ddasaro/LatticePoly/LatticePoly/resources/submission/${TEMP}/input.cfg > ${TMPDIR}/input.cfg


# Run
./${EXEC} ${TMPDIR}/input.cfg > ${TMPDIR}/log.out

#Analysis


python3 /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_trans_200_cool.py ${TMPDIR}   20000 2
python3 /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_cis_200_cool.py ${TMPDIR}   20000 2

python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_trans_intervals_cool.py ${TMPDIR} 50000 0 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_cis_intervals_cool.py ${TMPDIR} 50000 0 2

python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_trans_intervals_cool.py ${TMPDIR} 50000 50 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_cis_intervals_cool.py ${TMPDIR} 50000 50 2

python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_trans_intervals_cool.py ${TMPDIR} 50000 100 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_cis_intervals_cool.py ${TMPDIR} 50000 100 2

python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_trans_intervals_cool.py ${TMPDIR} 50000 200 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_cis_intervals_cool.py ${TMPDIR} 50000 200 2

python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_trans_intervals_cool.py ${TMPDIR} 50000 400 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_cis_intervals_cool.py ${TMPDIR} 50000 400 2

python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_trans_intervals_cool.py ${TMPDIR} 50000 800 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_cis_intervals_cool.py ${TMPDIR} 50000 800 2

python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_trans_intervals_cool.py ${TMPDIR} 50000 1600 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_cis_intervals_cool.py ${TMPDIR} 50000 1600 2

python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_trans_intervals_cool.py ${TMPDIR} 50000 2000 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_M_cis_intervals_cool.py ${TMPDIR} 50000 2000 2


python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50000 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50050 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50150 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50250 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50350 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50450 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50550 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50650 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50750 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50850 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 50950 2


python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 0 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 100 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 200 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 300 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 400 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 500 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 600 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 700 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 800 2
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 900 2
#python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 1000 2

python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 0 4
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 100 4
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 200 4
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 300 4
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 400 4
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 500 4
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 600 4
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 700 4
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 800 4
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 900 4
#python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 1000 4

python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 0 3
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 100 3
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 200 3
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 300 3
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 400 3
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 500 3
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 600 3
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 700 3
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 800 3
python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 900 3
#python /home/ddasaro//LatticePoly/LatticePoly/resources/MonomerDist_HiC_2SC_after_repl_cooler.py ${TMPDIR} 1000 3





python /home/ddasaro//LatticePoly/LatticePoly/resources/Poly_Rcmdiff_SCs.py ${TMPDIR} 50000
python /home/ddasaro//LatticePoly/LatticePoly/resources/Gyration_moments.py ${TMPDIR} 50000
python /home/ddasaro//LatticePoly/LatticePoly/resources/PolyGyration.py ${TMPDIR} 50000

#PolyGyration.py
















# Move SLURM output files to data directory
mv ${SLURM_SUBMIT_DIR}/${SLURM_ARRAY_JOB_ID}_${SLURM_ARRAY_TASK_ID}.out ${TMPDIR}
mv ${SLURM_SUBMIT_DIR}/${SLURM_ARRAY_JOB_ID}_${SLURM_ARRAY_TASK_ID}.err ${TMPDIR}

# Create data directory on local disk
#[ ! -d "${DATDIR}" ] && mkdir -p ${DATDIR}

# Archive output files to home directory
tar --transform "s|^|${OUTDIR}/|" -czf /Xnfs/lbmcdb/Jost_team/ddasaro/year2/July23/calibration/${OUTDIR}.tar.gz -C ${TMPDIR} .
#tar -xzf ${DATDIR}/${OUTDIR}.tar.gz -C /Xnfs/lbmcdb/Jost_team/ddasaro/year2/April23/Ring/100
#rm -rf {DATDIR}/${OUTDIR}.tar.gz

# Clean scratch
#rm -rf ${TMPDIR}


